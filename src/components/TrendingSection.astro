---
import { Star } from 'lucide-react';
import TrendingModal from './TrendingModal.jsx';

const TMDB_API_KEY = "eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIzNGViMGQzM2RhZGNkZmNhZjI3ZWM5ZWJiZTBhMGRjZiIsIm5iZiI6MTY0NjQzMTA5Ni45Miwic3ViIjoiNjIyMjhiNzg5MDIwMTIwMDZkNGUxMzJjIiwic2NvcGVzIjpbImFwaV9yZWFkIl0sInZlcnNpb24iOjF9.UJoGbP2Vf9vWy_u6bpWUtiClAuTiHvb8RBPZbEHhiM8";
const IMAGE_BASE_URL = "https://image.tmdb.org/t/p/w342";

// Fetch trending content server-side
let trends = [];
try {
  const response = await fetch(
    'https://api.themoviedb.org/3/trending/all/week?language=de-DE',
    {
      headers: {
        Authorization: `Bearer ${TMDB_API_KEY}`,
        accept: 'application/json',
      },
    }
  );
  const data = await response.json();
  // Filter out items without posters or backdrops
  trends = data.results.filter(item => item.poster_path && item.backdrop_path).slice(0, 8);
} catch (error) {
  console.error('Error fetching trends:', error);
}
---

<section class="py-24 bg-slate-900 relative overflow-hidden">
  <!-- Background Elements -->
  <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
    <div class="absolute top-[-20%] right-[-10%] w-[800px] h-[800px] bg-brand-900/20 rounded-full blur-3xl"></div>
    <div class="absolute bottom-[-20%] left-[-10%] w-[800px] h-[800px] bg-indigo-900/20 rounded-full blur-3xl"></div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
    <div class="text-center mb-16">
      <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-brand-500/10 border border-brand-500/20 text-brand-400 text-sm font-medium mb-4">
        <Star className="w-4 h-4 fill-brand-400" />
        <span>Aktuelle Highlights</span>
      </div>
      <h2 class="text-3xl md:text-5xl font-bold text-white mb-6">
        Jetzt bei uns <span class="text-transparent bg-clip-text bg-gradient-to-r from-brand-400 to-brand-200">verfügbar</span>
      </h2>
      <p class="text-xl text-slate-400 max-w-2xl mx-auto">
        Entdecken Sie die aktuellsten Blockbuster und Serien-Hits. 
        Alles in bester 4K Qualität direkt abrufbar.
      </p>
    </div>

    <TrendingModal client:load trends={trends} imageBaseUrl={IMAGE_BASE_URL} />
  </div>
</section>
